# Веб-приложение для проведения опросов

Это веб-приложение на базе Django предназначено для проведения опросов с динамическим отображением вопросов, зависящих от ответов пользователя.

## Особенности

- Создание и редактирование опросов и вопросов через админ-панель Django.
- Динамическое отображение вопросов в зависимости от предыдущих ответов пользователя.
- Сохранение ответов пользователей с учетом сессии.
- Поддержка текстовых и выборных вопросов.
- Вывод статистики по опросам с детализацией по вопросам и ответам.

## Установка и запуск

Для запуска проекта необходимо:

1. Клонировать репозиторий:
    ```
    git clone https://github.com/Cur1yB/NOMIA
    ```

2. Установить зависимости из файла `requirements.txt`:
    ```
    pip install -r requirements.txt
    ```

3. Выполнить начальную настройку базы данных с помощью скрипта `create_db.sh`:
    ```
    ./create_db.sh
    ```

4. Запустить сервер разработки:
    ```
    python manage.py runserver
    ```

## Использование

После запуска сервера перейдите по адресу `http://localhost:8000/` для начала работы с опросом. Управление опросами и вопросами осуществляется через админ-панель Django.

## Структура проекта

- `models.py` содержит модели `Question`, `AnswerOption` и `UserResponse`.
- `views.py` включает в себя представления для работы с опросами и вопросами, а также для отображения статистики.
- `urls.py` определяет маршруты URL для доступа к функциям приложения.
- Папка `templates` содержит шаблоны HTML для отображения интерфейса пользователя.

### Вспомогательные функции (utils.py)

Файл `utils.py` включает в себя набор вспомогательных функций, используемых для обработки данных опросов и генерации статистики. Вот основные функции:

- `get_choice_statistics(request)`: Возвращает статистику по выборам ответов на вопросы для текущей сессии пользователя.
- `get_text_answers_statistics(request)`: Собирает статистику по текстовым ответам пользователя в текущей сессии.
- `transform_statistics(choice_statistics, text_statistics)`: Объединяет статистику по выборам и текстовым ответам, подготавливая данные для вывода.
- `get_all_questions_choice_statistics()`: Генерирует статистику по всем вариантам ответов в базе данных, независимо от сессии пользователя.
- `get_all_questions_text_answers_statistics()`: Собирает статистику по всем текстовым ответам в базе данных.
- `get_total_participants()`: Вычисляет общее количество уникальных участников опроса, основываясь на количестве уникальных сессий.
- `calculate_total_responses_for_text(question_id, choice_statistics)`: Рассчитывает общее количество ответов на текстовые вопросы для поддержки статистики.
- `calculate_question_ranks(questions_dict)`: Ранжирует вопросы в зависимости от общего количества ответов, поддерживая порядковые номера для вопросов с одинаковым количеством ответов.

Эти функции обеспечивают ключевую логику приложения для сбора и обработки данных опросов, позволяя динамически генерировать и отображать статистику ответов пользователей.

## Разработка

Приложение разработано с использованием Django версии 4.2 Для работы с базой данных используется PostgreSQL.
